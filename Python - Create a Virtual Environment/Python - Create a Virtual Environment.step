{"creationTimeStamp":"2022-10-15T16:09:21.746Z","modifiedTimeStamp":"2022-10-19T15:03:33.683Z","createdBy":"Sundaresh.Sankaran@sas.com","modifiedBy":"Sundaresh.Sankaran@sas.com","name":"Python - Create a Virtual Environment.step","displayName":"Python - Create a Virtual Environment.step","localDisplayName":"Python - Create a Virtual Environment.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","uri":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","uri":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","uri":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","uri":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","uri":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","uri":"/dataFlows/steps/2971fefb-bfb5-4bbe-9832-1235358c671f","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Parameters\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"venv\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Provide a name for your virtual environment (note: provide the full path if you want to persist your virtual environment)\",\n\t\t\t\t\t\"placeholder\": \"venv\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"req\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter the path to your requirements.txt file (or simply list your packages with a space between)\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Note: Creation of a virtual environment also activates the same.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"page2\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Python - Create a virtual environment\\n\\nThe \\\"Python - Create a virtual environment\\\" custom step helps users create a virtual Python environment, install a given set of packages, and work within the confines of the new Python environment for project or program-specific purposes.\\n\\nUsers may choose to persist the virtual environment folder for later reuse, by simply providing a full path to a persistent location, when asked to provide a name for the location (make sure to include the name for the virtualenv folder - i.e. /path/to/storage/venv).  In such a case, please provide a path on a shared file system, which you expect to access through another SAS session later on.  Most SAS Viya deployments may contain a /mnt/... folder location which serves this purpose.\\n\\nUsers also have an option to provide a requirements file consisting of packages which they would like pip-installed.  Either provide a path to a requirements.txt file which contains a list of python packages (and optionally, specific versions), or provide a list of packages as a string, separated by a space.\\n\\nCreated / contact : Sundaresh Sankaran (sundaresh.sankaran@sas.com) and Ali Aiello (ali.aiello@sas.com) \\n\\nVersion : 1.0.  (20MAY2022)\\n\\nFor more details, refer https://blogs.sas.com/content/subconsciousmusings/2022/05/16/python-a-la-carte/\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"venv\": \"venv\",\n\t\t\"req\": \"\"\n\t}\n}","templates":{"SAS":"/* SAS templated code goes here */\n\n\n\nproc python;\n\nsubmit;\n\nimport os\nfrom virtualenv import cli_run\n\nvenv=SAS.symget(\"venv\")\n\npyt=os.environ[\"PROC_PYPATH\"]\nSAS.symput(\"MAIN_PYTH\",str(pyt))\n\ncli_run([venv])\nactivate_this_file = os.path.join(venv,\"bin\",\"activate_this.py\")\nexec(open(activate_this_file).read(), {'__file__': str(activate_this_file)})\nSAS.symput(\"TEMP_PYTH\",str(os.path.join(venv,\"bin\",\"python3\")))\n\n\n\nendsubmit;\n\nquit;\nproc python terminate;\nquit;\n\noptions set=PROC_PYPATH=\"&TEMP_PYTH.\";\n\n%put &TEMP_PYTH.;\n%put &MAIN_PYTH.;\n\nproc python;\nsubmit;\nimport os\npyt=SAS.symget(\"TEMP_PYTH\")\nprint(\"Hello World\")\nreq=SAS.symget(\"req\")\nif os.path.isfile(req):\n    print(\"File provided\")\n    os.system(\"{pyt} -m pip install -r {req}\".format(pyt=pyt,req=req))\nelse:\n    print(\"List provided\")\n    os.system(\"{pyt} -m pip install {req}\".format(pyt=pyt,req=req))\n\nendsubmit;\nquit;\n\n\n\n\n"}}